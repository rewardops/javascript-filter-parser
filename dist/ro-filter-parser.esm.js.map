{"version":3,"file":"ro-filter-parser.esm.js","sources":["../src/ro-filter-parser.js"],"sourcesContent":["const nearley = require('nearley');\nconst grammar = require('./compiled-grammar/main');\n\n/**\n * The main function of the library. Parses the filter string to return a JSON object\n *\n * @export\n * @param {string} input - the filter string\n * @returns {object} - a json representation of the string\n */\nexport function parseFilterString(input) {\n  // Create a Parser object from our grammar.\n  const parser = new nearley.Parser(nearley.Grammar.fromCompiled(grammar));\n  parser.feed(input);\n\n  const results = parser.results;\n  if (results.length > 1) return 'Ambigous grammar. Bad!';\n  if (results.length === 0) return 'Empty result. Weird!';\n\n  return results[0];\n}\n\n/**\n * This takes in the array of category objects returned by the main parser and converts it into a format which is easier to consume.\n *\n * @export\n * @param {Array} categoryArray - an array of the form:\n * [\n *  {subcategory: true, includes: ['abc']}\n * ]\n * @returns {object} - a parsed object of the form:\n * {\n *  includedWithSubcategories: ['abc'],\n *  excludedWithSubcategories: [],\n *  includedWithoutSubcategories: [],\n *  excludedWithoutSubCategories: [],\n * }\n */\nexport function simplifyCategory(categoryArray) {\n  return categoryArray.reduce((resultObject, cat) => {\n    if (cat.subcategory) {\n      if (cat.includes) {\n        resultObject.includedWithSubcategories = cat.includes;\n      }\n      if (cat.excludes) {\n        resultObject.excludedWithSubcategories = cat.excludes;\n      }\n    } else {\n      if (cat.includes) {\n        resultObject.includedWithoutSubcategories = cat.includes;\n      }\n      if (cat.excludes) {\n        resultObject.excludedWithoutSubcategories = cat.excludes;\n      }\n    }\n    return resultObject;\n  }, {});\n}\n"],"names":[],"mappings":"AAAA,MAAM,OAAO,GAAG,OAAO,CAAC,SAAS,CAAC,CAAC;AACnC,MAAM,OAAO,GAAG,OAAO,CAAC,yBAAyB,CAAC,CAAC;;;;;;;;;AASnD,AAAO,SAAS,iBAAiB,CAAC,KAAK,EAAE;;EAEvC,MAAM,MAAM,GAAG,IAAI,OAAO,CAAC,MAAM,CAAC,OAAO,CAAC,OAAO,CAAC,YAAY,CAAC,OAAO,CAAC,CAAC,CAAC;EACzE,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;;EAEnB,MAAM,OAAO,GAAG,MAAM,CAAC,OAAO,CAAC;EAC/B,IAAI,OAAO,CAAC,MAAM,GAAG,CAAC,EAAE,OAAO,wBAAwB,CAAC;EACxD,IAAI,OAAO,CAAC,MAAM,KAAK,CAAC,EAAE,OAAO,sBAAsB,CAAC;;EAExD,OAAO,OAAO,CAAC,CAAC,CAAC,CAAC;CACnB;;;;;;;;;;;;;;;;;;AAkBD,AAAO,SAAS,gBAAgB,CAAC,aAAa,EAAE;EAC9C,OAAO,aAAa,CAAC,MAAM,CAAC,CAAC,YAAY,EAAE,GAAG,KAAK;IACjD,IAAI,GAAG,CAAC,WAAW,EAAE;MACnB,IAAI,GAAG,CAAC,QAAQ,EAAE;QAChB,YAAY,CAAC,yBAAyB,GAAG,GAAG,CAAC,QAAQ,CAAC;OACvD;MACD,IAAI,GAAG,CAAC,QAAQ,EAAE;QAChB,YAAY,CAAC,yBAAyB,GAAG,GAAG,CAAC,QAAQ,CAAC;OACvD;KACF,MAAM;MACL,IAAI,GAAG,CAAC,QAAQ,EAAE;QAChB,YAAY,CAAC,4BAA4B,GAAG,GAAG,CAAC,QAAQ,CAAC;OAC1D;MACD,IAAI,GAAG,CAAC,QAAQ,EAAE;QAChB,YAAY,CAAC,4BAA4B,GAAG,GAAG,CAAC,QAAQ,CAAC;OAC1D;KACF;IACD,OAAO,YAAY,CAAC;GACrB,EAAE,EAAE,CAAC,CAAC;CACR;;;;"}