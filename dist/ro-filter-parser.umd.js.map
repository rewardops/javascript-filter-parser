{"version":3,"file":"ro-filter-parser.umd.js","sources":["../src/util/category.js","../node_modules/ramda/es/__.js","../node_modules/ramda/es/internal/_isPlaceholder.js","../node_modules/ramda/es/internal/_curry1.js","../node_modules/ramda/es/internal/_curry2.js","../node_modules/ramda/es/internal/_concat.js","../node_modules/ramda/es/internal/_curry3.js","../node_modules/ramda/es/internal/_isArray.js","../node_modules/ramda/es/internal/_isString.js","../node_modules/ramda/es/internal/_isArrayLike.js","../node_modules/ramda/es/internal/_has.js","../node_modules/ramda/es/internal/_isInteger.js","../node_modules/ramda/es/internal/_makeFlat.js","../node_modules/ramda/es/internal/_objectIs.js","../node_modules/ramda/es/internal/_toISOString.js","../node_modules/ramda/es/internal/_isObject.js","../node_modules/ramda/es/flatten.js","../node_modules/ramda/es/mergeWithKey.js","../node_modules/ramda/es/mergeDeepWithKey.js","../node_modules/ramda/es/mergeDeepRight.js","../src/util/object-to-string.js","../src/util/get-object-index.js","../src/util/siv.js","../src/util/clean-object.js","../src/util/extract-siv-included.js","../src/ro-filter-parser.js"],"sourcesContent":["/* eslint-disable no-param-reassign */\nconst categoryTypes = [\n  'includedWithSubcategories',\n  'includedWithoutSubcategories',\n  'excludedWithSubcategories',\n  'excludedWithoutSubcategories',\n];\n\nexport function setCategoryCodes(subtype, values) {\n  const updatedCat = {};\n  if (subtype === 'subcategory-included') {\n    updatedCat.includedWithSubcategories = [...values];\n  }\n  if (subtype === 'subcategory-excluded') {\n    updatedCat.includedWithoutSubcategories = [...values];\n  }\n  return updatedCat;\n}\n\nexport function addCategoryCodes(categoryObject, subtype, values) {\n  // If the value already exists anywhere in categories, remove it\n  categoryTypes.forEach(type => {\n    if (categoryObject[type]) {\n      categoryObject[type] = categoryObject[type].filter(value => !values.includes(value));\n    }\n  });\n  if (subtype === 'subcategory-included') {\n    const currentValues = categoryObject.includedWithSubcategories || [];\n    categoryObject.includedWithSubcategories = Array.from(new Set([...currentValues, ...values]));\n  }\n  if (subtype === 'subcategory-excluded') {\n    const currentValues = categoryObject.includedWithoutSubcategories || [];\n    categoryObject.includedWithoutSubcategories = Array.from(new Set([...currentValues, ...values]));\n  }\n  return categoryObject;\n}\n","/**\n * A special placeholder value used to specify \"gaps\" within curried functions,\n * allowing partial application of any combination of arguments, regardless of\n * their positions.\n *\n * If `g` is a curried ternary function and `_` is `R.__`, the following are\n * equivalent:\n *\n *   - `g(1, 2, 3)`\n *   - `g(_, 2, 3)(1)`\n *   - `g(_, _, 3)(1)(2)`\n *   - `g(_, _, 3)(1, 2)`\n *   - `g(_, 2, _)(1, 3)`\n *   - `g(_, 2)(1)(3)`\n *   - `g(_, 2)(1, 3)`\n *   - `g(_, 2)(_, 3)(1)`\n *\n * @name __\n * @constant\n * @memberOf R\n * @since v0.6.0\n * @category Function\n * @example\n *\n *      const greet = R.replace('{name}', R.__, 'Hello, {name}!');\n *      greet('Alice'); //=> 'Hello, Alice!'\n */\nexport default { '@@functional/placeholder': true };","export default function _isPlaceholder(a) {\n       return a != null && typeof a === 'object' && a['@@functional/placeholder'] === true;\n}","import _isPlaceholder from './_isPlaceholder.js';\n\n/**\n * Optimized internal one-arity curry function.\n *\n * @private\n * @category Function\n * @param {Function} fn The function to curry.\n * @return {Function} The curried function.\n */\nexport default function _curry1(fn) {\n  return function f1(a) {\n    if (arguments.length === 0 || _isPlaceholder(a)) {\n      return f1;\n    } else {\n      return fn.apply(this, arguments);\n    }\n  };\n}","import _curry1 from './_curry1.js';\nimport _isPlaceholder from './_isPlaceholder.js';\n\n/**\n * Optimized internal two-arity curry function.\n *\n * @private\n * @category Function\n * @param {Function} fn The function to curry.\n * @return {Function} The curried function.\n */\nexport default function _curry2(fn) {\n  return function f2(a, b) {\n    switch (arguments.length) {\n      case 0:\n        return f2;\n      case 1:\n        return _isPlaceholder(a) ? f2 : _curry1(function (_b) {\n          return fn(a, _b);\n        });\n      default:\n        return _isPlaceholder(a) && _isPlaceholder(b) ? f2 : _isPlaceholder(a) ? _curry1(function (_a) {\n          return fn(_a, b);\n        }) : _isPlaceholder(b) ? _curry1(function (_b) {\n          return fn(a, _b);\n        }) : fn(a, b);\n    }\n  };\n}","/**\n * Private `concat` function to merge two array-like objects.\n *\n * @private\n * @param {Array|Arguments} [set1=[]] An array-like object.\n * @param {Array|Arguments} [set2=[]] An array-like object.\n * @return {Array} A new, merged array.\n * @example\n *\n *      _concat([4, 5, 6], [1, 2, 3]); //=> [4, 5, 6, 1, 2, 3]\n */\nexport default function _concat(set1, set2) {\n  set1 = set1 || [];\n  set2 = set2 || [];\n  var idx;\n  var len1 = set1.length;\n  var len2 = set2.length;\n  var result = [];\n\n  idx = 0;\n  while (idx < len1) {\n    result[result.length] = set1[idx];\n    idx += 1;\n  }\n  idx = 0;\n  while (idx < len2) {\n    result[result.length] = set2[idx];\n    idx += 1;\n  }\n  return result;\n}","import _curry1 from './_curry1.js';\nimport _curry2 from './_curry2.js';\nimport _isPlaceholder from './_isPlaceholder.js';\n\n/**\n * Optimized internal three-arity curry function.\n *\n * @private\n * @category Function\n * @param {Function} fn The function to curry.\n * @return {Function} The curried function.\n */\nexport default function _curry3(fn) {\n  return function f3(a, b, c) {\n    switch (arguments.length) {\n      case 0:\n        return f3;\n      case 1:\n        return _isPlaceholder(a) ? f3 : _curry2(function (_b, _c) {\n          return fn(a, _b, _c);\n        });\n      case 2:\n        return _isPlaceholder(a) && _isPlaceholder(b) ? f3 : _isPlaceholder(a) ? _curry2(function (_a, _c) {\n          return fn(_a, b, _c);\n        }) : _isPlaceholder(b) ? _curry2(function (_b, _c) {\n          return fn(a, _b, _c);\n        }) : _curry1(function (_c) {\n          return fn(a, b, _c);\n        });\n      default:\n        return _isPlaceholder(a) && _isPlaceholder(b) && _isPlaceholder(c) ? f3 : _isPlaceholder(a) && _isPlaceholder(b) ? _curry2(function (_a, _b) {\n          return fn(_a, _b, c);\n        }) : _isPlaceholder(a) && _isPlaceholder(c) ? _curry2(function (_a, _c) {\n          return fn(_a, b, _c);\n        }) : _isPlaceholder(b) && _isPlaceholder(c) ? _curry2(function (_b, _c) {\n          return fn(a, _b, _c);\n        }) : _isPlaceholder(a) ? _curry1(function (_a) {\n          return fn(_a, b, c);\n        }) : _isPlaceholder(b) ? _curry1(function (_b) {\n          return fn(a, _b, c);\n        }) : _isPlaceholder(c) ? _curry1(function (_c) {\n          return fn(a, b, _c);\n        }) : fn(a, b, c);\n    }\n  };\n}","/**\n * Tests whether or not an object is an array.\n *\n * @private\n * @param {*} val The object to test.\n * @return {Boolean} `true` if `val` is an array, `false` otherwise.\n * @example\n *\n *      _isArray([]); //=> true\n *      _isArray(null); //=> false\n *      _isArray({}); //=> false\n */\nexport default Array.isArray || function _isArray(val) {\n  return val != null && val.length >= 0 && Object.prototype.toString.call(val) === '[object Array]';\n};","export default function _isString(x) {\n  return Object.prototype.toString.call(x) === '[object String]';\n}","import _curry1 from './_curry1.js';\nimport _isArray from './_isArray.js';\nimport _isString from './_isString.js';\n\n/**\n * Tests whether or not an object is similar to an array.\n *\n * @private\n * @category Type\n * @category List\n * @sig * -> Boolean\n * @param {*} x The object to test.\n * @return {Boolean} `true` if `x` has a numeric length property and extreme indices defined; `false` otherwise.\n * @example\n *\n *      _isArrayLike([]); //=> true\n *      _isArrayLike(true); //=> false\n *      _isArrayLike({}); //=> false\n *      _isArrayLike({length: 10}); //=> false\n *      _isArrayLike({0: 'zero', 9: 'nine', length: 10}); //=> true\n */\nvar _isArrayLike = /*#__PURE__*/_curry1(function isArrayLike(x) {\n  if (_isArray(x)) {\n    return true;\n  }\n  if (!x) {\n    return false;\n  }\n  if (typeof x !== 'object') {\n    return false;\n  }\n  if (_isString(x)) {\n    return false;\n  }\n  if (x.nodeType === 1) {\n    return !!x.length;\n  }\n  if (x.length === 0) {\n    return true;\n  }\n  if (x.length > 0) {\n    return x.hasOwnProperty(0) && x.hasOwnProperty(x.length - 1);\n  }\n  return false;\n});\nexport default _isArrayLike;","export default function _has(prop, obj) {\n  return Object.prototype.hasOwnProperty.call(obj, prop);\n}","/**\n * Determine if the passed argument is an integer.\n *\n * @private\n * @param {*} n\n * @category Type\n * @return {Boolean}\n */\nexport default Number.isInteger || function _isInteger(n) {\n  return n << 0 === n;\n};","import _isArrayLike from './_isArrayLike.js';\n\n/**\n * `_makeFlat` is a helper function that returns a one-level or fully recursive\n * function based on the flag passed in.\n *\n * @private\n */\nexport default function _makeFlat(recursive) {\n  return function flatt(list) {\n    var value, jlen, j;\n    var result = [];\n    var idx = 0;\n    var ilen = list.length;\n\n    while (idx < ilen) {\n      if (_isArrayLike(list[idx])) {\n        value = recursive ? flatt(list[idx]) : list[idx];\n        j = 0;\n        jlen = value.length;\n        while (j < jlen) {\n          result[result.length] = value[j];\n          j += 1;\n        }\n      } else {\n        result[result.length] = list[idx];\n      }\n      idx += 1;\n    }\n    return result;\n  };\n}","// Based on https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/is\nfunction _objectIs(a, b) {\n  // SameValue algorithm\n  if (a === b) {\n    // Steps 1-5, 7-10\n    // Steps 6.b-6.e: +0 != -0\n    return a !== 0 || 1 / a === 1 / b;\n  } else {\n    // Step 6.a: NaN == NaN\n    return a !== a && b !== b;\n  }\n}\n\nexport default typeof Object.is === 'function' ? Object.is : _objectIs;","/**\n * Polyfill from <https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date/toISOString>.\n */\nvar pad = function pad(n) {\n  return (n < 10 ? '0' : '') + n;\n};\n\nvar _toISOString = typeof Date.prototype.toISOString === 'function' ? function _toISOString(d) {\n  return d.toISOString();\n} : function _toISOString(d) {\n  return d.getUTCFullYear() + '-' + pad(d.getUTCMonth() + 1) + '-' + pad(d.getUTCDate()) + 'T' + pad(d.getUTCHours()) + ':' + pad(d.getUTCMinutes()) + ':' + pad(d.getUTCSeconds()) + '.' + (d.getUTCMilliseconds() / 1000).toFixed(3).slice(2, 5) + 'Z';\n};\n\nexport default _toISOString;","export default function _isObject(x) {\n  return Object.prototype.toString.call(x) === '[object Object]';\n}","import _curry1 from './internal/_curry1.js';\nimport _makeFlat from './internal/_makeFlat.js';\n\n/**\n * Returns a new list by pulling every item out of it (and all its sub-arrays)\n * and putting them in a new array, depth-first.\n *\n * @func\n * @memberOf R\n * @since v0.1.0\n * @category List\n * @sig [a] -> [b]\n * @param {Array} list The array to consider.\n * @return {Array} The flattened list.\n * @see R.unnest\n * @example\n *\n *      R.flatten([1, 2, [3, 4], 5, [6, [7, 8, [9, [10, 11], 12]]]]);\n *      //=> [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12]\n */\nvar flatten = /*#__PURE__*/_curry1( /*#__PURE__*/_makeFlat(true));\nexport default flatten;","import _curry3 from './internal/_curry3.js';\nimport _has from './internal/_has.js';\n\n/**\n * Creates a new object with the own properties of the two provided objects. If\n * a key exists in both objects, the provided function is applied to the key\n * and the values associated with the key in each object, with the result being\n * used as the value associated with the key in the returned object.\n *\n * @func\n * @memberOf R\n * @since v0.19.0\n * @category Object\n * @sig ((String, a, a) -> a) -> {a} -> {a} -> {a}\n * @param {Function} fn\n * @param {Object} l\n * @param {Object} r\n * @return {Object}\n * @see R.mergeDeepWithKey, R.merge, R.mergeWith\n * @example\n *\n *      let concatValues = (k, l, r) => k == 'values' ? R.concat(l, r) : r\n *      R.mergeWithKey(concatValues,\n *                     { a: true, thing: 'foo', values: [10, 20] },\n *                     { b: true, thing: 'bar', values: [15, 35] });\n *      //=> { a: true, b: true, thing: 'bar', values: [10, 20, 15, 35] }\n * @symb R.mergeWithKey(f, { x: 1, y: 2 }, { y: 5, z: 3 }) = { x: 1, y: f('y', 2, 5), z: 3 }\n */\nvar mergeWithKey = /*#__PURE__*/_curry3(function mergeWithKey(fn, l, r) {\n  var result = {};\n  var k;\n\n  for (k in l) {\n    if (_has(k, l)) {\n      result[k] = _has(k, r) ? fn(k, l[k], r[k]) : l[k];\n    }\n  }\n\n  for (k in r) {\n    if (_has(k, r) && !_has(k, result)) {\n      result[k] = r[k];\n    }\n  }\n\n  return result;\n});\nexport default mergeWithKey;","import _curry3 from './internal/_curry3.js';\nimport _isObject from './internal/_isObject.js';\nimport mergeWithKey from './mergeWithKey.js';\n\n/**\n * Creates a new object with the own properties of the two provided objects.\n * If a key exists in both objects:\n * - and both associated values are also objects then the values will be\n *   recursively merged.\n * - otherwise the provided function is applied to the key and associated values\n *   using the resulting value as the new value associated with the key.\n * If a key only exists in one object, the value will be associated with the key\n * of the resulting object.\n *\n * @func\n * @memberOf R\n * @since v0.24.0\n * @category Object\n * @sig ((String, a, a) -> a) -> {a} -> {a} -> {a}\n * @param {Function} fn\n * @param {Object} lObj\n * @param {Object} rObj\n * @return {Object}\n * @see R.mergeWithKey, R.mergeDeepWith\n * @example\n *\n *      let concatValues = (k, l, r) => k == 'values' ? R.concat(l, r) : r\n *      R.mergeDeepWithKey(concatValues,\n *                         { a: true, c: { thing: 'foo', values: [10, 20] }},\n *                         { b: true, c: { thing: 'bar', values: [15, 35] }});\n *      //=> { a: true, b: true, c: { thing: 'bar', values: [10, 20, 15, 35] }}\n */\nvar mergeDeepWithKey = /*#__PURE__*/_curry3(function mergeDeepWithKey(fn, lObj, rObj) {\n  return mergeWithKey(function (k, lVal, rVal) {\n    if (_isObject(lVal) && _isObject(rVal)) {\n      return mergeDeepWithKey(fn, lVal, rVal);\n    } else {\n      return fn(k, lVal, rVal);\n    }\n  }, lObj, rObj);\n});\nexport default mergeDeepWithKey;","import _curry2 from './internal/_curry2.js';\nimport mergeDeepWithKey from './mergeDeepWithKey.js';\n\n/**\n * Creates a new object with the own properties of the first object merged with\n * the own properties of the second object. If a key exists in both objects:\n * - and both values are objects, the two values will be recursively merged\n * - otherwise the value from the second object will be used.\n *\n * @func\n * @memberOf R\n * @since v0.24.0\n * @category Object\n * @sig {a} -> {a} -> {a}\n * @param {Object} lObj\n * @param {Object} rObj\n * @return {Object}\n * @see R.merge, R.mergeDeepLeft, R.mergeDeepWith, R.mergeDeepWithKey\n * @example\n *\n *      R.mergeDeepRight({ name: 'fred', age: 10, contact: { email: 'moo@example.com' }},\n *                       { age: 40, contact: { email: 'baa@example.com' }});\n *      //=> { name: 'fred', age: 40, contact: { email: 'baa@example.com' }}\n */\nvar mergeDeepRight = /*#__PURE__*/_curry2(function mergeDeepRight(lObj, rObj) {\n  return mergeDeepWithKey(function (k, lVal, rVal) {\n    return rVal;\n  }, lObj, rObj);\n});\nexport default mergeDeepRight;","// Coz flatMap seems to be implemented only in Node11\nimport { flatten } from 'ramda';\n\nexport default function convertObjectToString(filter) {\n  if (filter.constructor === Array) {\n    return filter.map(f => `${convertObjectToString(f)}`).join('|');\n  }\n  if (filter.constructor === Object) {\n    const filterArray = [];\n    if (filter.SIV_ATTRIBUTE) {\n      const filterStringArray = flatten(\n        Object.keys(filter.SIV_ATTRIBUTE).map(type =>\n          Object.keys(filter.SIV_ATTRIBUTE[type]).map(subtype => {\n            const equalOp = subtype.includes('include') ? '==' : '!=';\n            const values = filter.SIV_ATTRIBUTE[type][subtype].map(value => `${value}`).join(',');\n            return `SIV_ATTRIBUTE(${type})${equalOp}[${values}]`;\n          })\n        )\n      );\n\n      filterArray.push(...filterStringArray);\n    }\n    if (filter.CATEGORY) {\n      const { CATEGORY } = filter;\n      const filterStringArray = Object.keys(CATEGORY).map(key => {\n        const equalOp = key.includes('include') ? '==' : '!=';\n        const subcategoryOp = key.includes('Without') ? 'false' : 'true';\n        const values = CATEGORY[key].map(value => `\"${value}\"`).join(',');\n        return `CATEGORY(${subcategoryOp})${equalOp}[${values}]`;\n      });\n      filterArray.push(filterStringArray);\n    }\n    if (filter.array) {\n      filterArray.push(convertObjectToString(filter.array));\n    }\n    return filterArray.length > 1 ? `(${filterArray.join('&')})` : filterArray.join('&');\n  }\n  return '';\n}\n","export default function getObjectIndex(filterArray) {\n  let result;\n  filterArray.forEach((f, i) => {\n    if (JSON.stringify(f) !== '{}') {\n      result = i;\n    }\n  });\n  return result;\n}\n","import { mergeDeepRight } from 'ramda';\nimport getObjectIndex from './get-object-index';\n\n/* eslint-disable no-param-reassign */\nexport default function setSivValues(parsedFilter, sivIncluded, subtype, values) {\n  let includedIds = sivIncluded ? sivIncluded.SIV_ATTRIBUTE.id.included : [];\n  if (subtype === 'id-included') {\n    includedIds = values;\n    // Rewrite this so that we don't need param reassign\n    parsedFilter.forEach((f, index) => {\n      if (\n        parsedFilter[index].SIV_ATTRIBUTE\n        && parsedFilter[index].SIV_ATTRIBUTE.id\n        && parsedFilter[index].SIV_ATTRIBUTE.id.excluded\n      ) {\n        parsedFilter[index].SIV_ATTRIBUTE.id.excluded = parsedFilter[index].SIV_ATTRIBUTE.id.excluded.filter(\n          id => !values.includes(id),\n        );\n      }\n      // If all the included values are filtered out, delete SIV_ATTRIBUTE key\n      if (\n        parsedFilter[index].SIV_ATTRIBUTE\n        && parsedFilter[index].SIV_ATTRIBUTE.id\n        && parsedFilter[index].SIV_ATTRIBUTE.id.excluded\n        && parsedFilter[index].SIV_ATTRIBUTE.id.excluded.length === 0\n      ) {\n        delete parsedFilter[index].SIV_ATTRIBUTE.id;\n      }\n    });\n  }\n  if (subtype === 'id-excluded') {\n    let updated = false;\n    if (sivIncluded) {\n      includedIds = includedIds.filter(id => !values.includes(id));\n    }\n    parsedFilter.forEach((f, index) => {\n      if (\n        parsedFilter[index].SIV_ATTRIBUTE\n        && parsedFilter[index].SIV_ATTRIBUTE.id\n        && parsedFilter[index].SIV_ATTRIBUTE.id.excluded\n      ) {\n        parsedFilter[index].SIV_ATTRIBUTE.id.excluded = values;\n        updated = true;\n      }\n    });\n    if (!updated) {\n      const index = getObjectIndex(parsedFilter);\n      parsedFilter[index] = mergeDeepRight(parsedFilter[index], { SIV_ATTRIBUTE: { id: { excluded: values } } });\n    }\n  }\n  if (subtype === 'supplier-included') {\n    const index = getObjectIndex(parsedFilter);\n    parsedFilter[index] = mergeDeepRight(parsedFilter[index], { SIV_ATTRIBUTE: { supplier: { included: values } } });\n  }\n  const updatedSivIncluded = includedIds.length ? { SIV_ATTRIBUTE: { id: { included: includedIds } } } : null;\n  return { parsedFilter, updatedSivIncluded };\n}\n","/**\n * This is used to remove any empty objects going through it recursively\n *\n * @export\n * @param {Object} obj\n * @returns {Object}\n *\n * @example\n  const test = {\n    SIV: {\n      id: {},\n      incl: [1]\n    },\n    SIV2: {\n      id: {\n        included: {}\n      }\n    }\n  }\n\n  cleanObject(test)\n  Output: { SIV: { incl: [ 1 ] } }\n */\nexport default function cleanObject(obj) {\n  const resultObject = {};\n  Object.keys(obj).forEach(key => {\n    if (obj[key].constructor === Object) {\n      resultObject[key] = cleanObject(obj[key]);\n      if (JSON.stringify(resultObject[key]) === '{}') {\n        delete resultObject[key];\n      }\n    } else {\n      resultObject[key] = obj[key];\n    }\n  });\n  return resultObject;\n}\n","export default function extractSivIncluded(parsedFilter, sivIncluded) {\n  let updatedSivIncluded = sivIncluded;\n  const updatedFilter = parsedFilter.map(filter => {\n    if (filter.SIV_ATTRIBUTE && filter.SIV_ATTRIBUTE.id.included) {\n      if (updatedSivIncluded) {\n        updatedSivIncluded.SIV_ATTRIBUTE.id.included.push(...filter.SIV_ATTRIBUTE.id.included);\n      } else {\n        updatedSivIncluded = {\n          SIV_ATTRIBUTE: {\n            id: {\n              included: filter.SIV_ATTRIBUTE.id.included,\n            },\n          },\n        };\n      }\n      delete filter.SIV_ATTRIBUTE.id.included;\n    }\n    if (filter.array) {\n      ({ updatedFilter: filter.array, updatedSivIncluded } = extractSivIncluded(filter.array, updatedSivIncluded));\n      // This is being done only because of the way the current filter definitions are set up where they are wrongly grouped based on the OR.\n      // Basically all the current definitions have been slightly wrong but because they were never grouped with anything else, it was not noticable.\n      filter.array.forEach(f => {\n        if (f.CATEGORY) {\n          filter.CATEGORY = f.CATEGORY;\n        }\n        delete f.CATEGORY;\n      });\n    }\n    return filter;\n  });\n  return { updatedFilter, updatedSivIncluded };\n}\n","import { setCategoryCodes, addCategoryCodes } from './util/category';\nimport convertObjectToString from './util/object-to-string';\nimport setSivValues from './util/siv';\nimport cleanObject from './util/clean-object';\nimport extractSivIncluded from './util/extract-siv-included';\n\nconst nearley = require('nearley');\nconst grammar = require('../src/compiled-grammar/main');\n\n/**\n * The main function of the library. Parses the filter string to return a JSON object\n *\n * @export\n * @param {string} filterString - the filter string\n * @returns {object} - a json representation of the string\n */\nexport function parseFilterString(filterString) {\n  // Create a Parser object from our grammar.\n  const parser = new nearley.Parser(nearley.Grammar.fromCompiled(grammar));\n  parser.feed(filterString);\n\n  const { results } = parser;\n  if (results.length > 1) return 'Ambigous grammar. Bad!';\n  if (results.length === 0) return 'Empty result. Weird!';\n\n  return results[0];\n}\n\nexport function addToFilter(definition, { label, subtype, values }) {\n  const parsedFilter = parseFilterString(definition);\n  switch (label) {\n    case 'CATEGORY':\n      parsedFilter.forEach((filter, index) => {\n        if (parsedFilter[index].CATEGORY) {\n          parsedFilter[index].CATEGORY = addCategoryCodes(filter.CATEGORY, subtype, values);\n        }\n      });\n      break;\n\n    default:\n      break;\n  }\n  return convertObjectToString(parsedFilter);\n}\n\nexport function setFilter(definition, { label, subtype, values }) {\n  let parsedFilter = parseFilterString(definition);\n\n  // SIV ATTRIBUTE Included is a special case where if the value is included that is \"ORed\" to all the other rules.\n  // So we extract it out\n  let sivIncluded;\n  ({ updatedSivIncluded: sivIncluded, updatedFilter: parsedFilter } = extractSivIncluded(parsedFilter, sivIncluded));\n\n  parsedFilter.forEach((filter, index) => {\n    if (parsedFilter[index].array) {\n      const cleanArray = parsedFilter[index].array.map(f => cleanObject(f)).filter(f => JSON.stringify(f) !== '{}');\n      if (cleanArray.length) {\n        parsedFilter[index].array = cleanArray;\n      } else {\n        delete parsedFilter[index].array;\n      }\n    }\n  });\n\n  switch (label) {\n    case 'CATEGORY': {\n      let updated = false;\n      parsedFilter.forEach((filter, index) => {\n        if (parsedFilter[index].CATEGORY) {\n          parsedFilter[index].CATEGORY = setCategoryCodes(subtype, values);\n          updated = true;\n        }\n      });\n      if (!updated) {\n        const CATEGORY = setCategoryCodes(subtype, values);\n        parsedFilter[0].CATEGORY = CATEGORY;\n      }\n      break;\n    }\n    case 'SIV': {\n      ({ updatedSivIncluded: sivIncluded, parsedFilter } = setSivValues(parsedFilter, sivIncluded, subtype, values));\n      break;\n    }\n\n    default:\n      break;\n  }\n\n  // Remove any empty objects (maybe caused by the SIV extraction)\n  parsedFilter.forEach((filter, index) => {\n    parsedFilter[index] = cleanObject(parsedFilter[index]);\n  });\n  parsedFilter = parsedFilter.filter(filter => JSON.stringify(filter) !== '{}');\n  if (sivIncluded && parsedFilter.length) {\n    parsedFilter.push(sivIncluded);\n  }\n  const convertedFilter = parsedFilter.length ? parsedFilter : sivIncluded;\n  return convertObjectToString(convertedFilter);\n}\n"],"names":["categoryTypes","setCategoryCodes","subtype","values","updatedCat","includedWithSubcategories","includedWithoutSubcategories","addCategoryCodes","categoryObject","forEach","type","filter","value","includes","currentValues","Array","from","Set","convertObjectToString","constructor","map","f","join","Object","filterArray","SIV_ATTRIBUTE","filterStringArray","flatten","keys","equalOp","push","CATEGORY","key","subcategoryOp","array","length","getObjectIndex","result","i","JSON","stringify","setSivValues","parsedFilter","sivIncluded","includedIds","id","included","index","excluded","updated","mergeDeepRight","supplier","updatedSivIncluded","cleanObject","obj","resultObject","extractSivIncluded","updatedFilter","nearley","require","grammar","parseFilterString","filterString","parser","Parser","Grammar","fromCompiled","feed","results","addToFilter","definition","label","setFilter","cleanArray","convertedFilter"],"mappings":"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"}