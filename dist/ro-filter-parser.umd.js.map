{"version":3,"file":"ro-filter-parser.umd.js","sources":["../src/ro-filter-parser.js"],"sourcesContent":["const nearley = require('nearley');\nconst grammar = require('../src/compiled-grammar/main');\n\n/**\n * The main function of the library. Parses the filter string to return a JSON object\n *\n * @export\n * @param {string} input - the filter string\n * @returns {object} - a json representation of the string\n */\nexport function parseFilterString(input) {\n  // Create a Parser object from our grammar.\n  const parser = new nearley.Parser(nearley.Grammar.fromCompiled(grammar));\n  parser.feed(input);\n\n  const results = parser.results;\n  if (results.length > 1) return 'Ambigous grammar. Bad!';\n  if (results.length === 0) return 'Empty result. Weird!';\n\n  return results[0];\n}\n\n/**\n * This takes in the array of category objects returned by the main parser and converts it into a format which is easier to consume.\n *\n * @export\n * @param {Array} categoryArray - an array of the form:\n * [\n *  {subcategory: true, included: ['abc']}\n * ]\n * @returns {object} - a parsed object of the form:\n * {\n *  includedWithSubcategories: ['abc'],\n *  excludedWithSubcategories: [],\n *  includedWithoutSubcategories: [],\n *  excludedWithoutSubCategories: [],\n * }\n */\nexport function simplifyCategory(categoryArray) {\n  return categoryArray.reduce((resultObject, cat) => {\n    if (cat.subcategory) {\n      if (cat.included) {\n        resultObject.includedWithSubcategories = cat.included;\n      }\n      if (cat.excluded) {\n        resultObject.excludedWithSubcategories = cat.excluded;\n      }\n    } else {\n      if (cat.included) {\n        resultObject.includedWithoutSubcategories = cat.included;\n      }\n      if (cat.excluded) {\n        resultObject.excludedWithoutSubcategories = cat.excluded;\n      }\n    }\n    return resultObject;\n  }, {});\n}\n"],"names":[],"mappings":";;;;;;EAAA,MAAM,OAAO,GAAG,OAAO,CAAC,SAAS,CAAC,CAAC;EACnC,MAAM,OAAO,GAAG,OAAO,CAAC,8BAA8B,CAAC,CAAC;;EAExD;EACA;EACA;EACA;EACA;EACA;EACA;AACA,EAAO,SAAS,iBAAiB,CAAC,KAAK,EAAE;EACzC;EACA,EAAE,MAAM,MAAM,GAAG,IAAI,OAAO,CAAC,MAAM,CAAC,OAAO,CAAC,OAAO,CAAC,YAAY,CAAC,OAAO,CAAC,CAAC,CAAC;EAC3E,EAAE,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;;EAErB,EAAE,MAAM,OAAO,GAAG,MAAM,CAAC,OAAO,CAAC;EACjC,EAAE,IAAI,OAAO,CAAC,MAAM,GAAG,CAAC,EAAE,OAAO,wBAAwB,CAAC;EAC1D,EAAE,IAAI,OAAO,CAAC,MAAM,KAAK,CAAC,EAAE,OAAO,sBAAsB,CAAC;;EAE1D,EAAE,OAAO,OAAO,CAAC,CAAC,CAAC,CAAC;EACpB,CAAC;;EAED;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;AACA,EAAO,SAAS,gBAAgB,CAAC,aAAa,EAAE;EAChD,EAAE,OAAO,aAAa,CAAC,MAAM,CAAC,CAAC,YAAY,EAAE,GAAG,KAAK;EACrD,IAAI,IAAI,GAAG,CAAC,WAAW,EAAE;EACzB,MAAM,IAAI,GAAG,CAAC,QAAQ,EAAE;EACxB,QAAQ,YAAY,CAAC,yBAAyB,GAAG,GAAG,CAAC,QAAQ,CAAC;EAC9D,OAAO;EACP,MAAM,IAAI,GAAG,CAAC,QAAQ,EAAE;EACxB,QAAQ,YAAY,CAAC,yBAAyB,GAAG,GAAG,CAAC,QAAQ,CAAC;EAC9D,OAAO;EACP,KAAK,MAAM;EACX,MAAM,IAAI,GAAG,CAAC,QAAQ,EAAE;EACxB,QAAQ,YAAY,CAAC,4BAA4B,GAAG,GAAG,CAAC,QAAQ,CAAC;EACjE,OAAO;EACP,MAAM,IAAI,GAAG,CAAC,QAAQ,EAAE;EACxB,QAAQ,YAAY,CAAC,4BAA4B,GAAG,GAAG,CAAC,QAAQ,CAAC;EACjE,OAAO;EACP,KAAK;EACL,IAAI,OAAO,YAAY,CAAC;EACxB,GAAG,EAAE,EAAE,CAAC,CAAC;EACT,CAAC;;;;;;;;;;;;;"}